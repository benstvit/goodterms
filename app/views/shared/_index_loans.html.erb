<div class="dashboard-container">
  <div class="loan-index" data-controller='modal'>
    <% loans.each do |loan| %>
      <% unless loan.status == 'returned' %>
        <% if loan.id % 2 == 0  %>
          <div class="card-even">
            <% if loan.item.user == current_user %>
              <div class="card-lending" data-modal-target="loan" data-id= "<%= loan.id %>">
                <div class="loan-card-image"><%= cl_image_tag (loan.item.photo.key) %>
                </div>
                <p style="color: white; font-size: 40px;"><%= loan.item.item_name %></p>
                <div class="loan-card-item-info">
                  <p><%= "üë§ Lent to #{loan.user.first_name}" %></p>
                  <p><%="üéØ #{loan.return_date}" %></p>
                  <p><%= "üìù #{loan.item.description}" %></p>
                  <p>Rating:</p>
                  <div class='review'>
                    <% if loan.user.reviews.length >= 2 %>
                      <%= 'üåü' %>
                    <% elsif loan.user.reviews.length >= 0 %>
                      <%= '‚≠ê' %>
                    <% else %>
                      <%= 'No rating yet üòí' %>
                    <% end %>
                  </div>
                </div>
                <div class="loan-card-item-info-actions d-flex justify-content-between p-5">
                  <button class="review-btn" title="Give a review">‚≠êÔ∏è</button>
                  <div id="myModal" class="modal" data-controller="review">
                    <div class="modal-content">
                      <span class="close">&times;</span>
                      <%= render 'shared/new_review', loan: loan %>
                    </div>
                  </div>
                  <%= link_to 'üíå', user_path(loan.user), class: 'return-btn'%>
                  <% if loan.status == 'pending' %>
                    <div title="Accept loan" >
                      <button class='return-btn' data-modal-target='accept' data-action="click->modal#confirm" data-user_id="<%= loan.user %>" data-id= "<%= loan.id %>">
                      Ôºü</button>
                    </div>
                  <% else %>
                    <div title="Mark as returned" >
                      <button class='return-btn' data-action="click->modal#alert" data-id= "<%= loan.id %>" data-user_id="<%= loan.user %>">
                      ‚úÖ</button>
                    </div>
                  <% end %>
                </div>
              </div>
            <% else %>
              <div class="card-borrowing">
                <div class="loan-card-image"><%= cl_image_tag (loan.item.photo.key) %>
                </div>
                <p style="color: white; font-size: 40px;"><%= loan.item.item_name %></p>
                <div class="loan-card-item-info">
                  <p><%="üë§ Borrowed from #{loan.item.user.first_name}" %></p>
                  <p><%="üéØ #{loan.return_date}" %></p>
                  <p><%= "üìù #{loan.item.description}" %></p>
                  <p>Rating:</p>
                  <div class='review'>
                    <% if loan.user.reviews.length >= 2 %>
                      <%= 'üåü' %>
                    <% elsif loan.user.reviews.length >= 0 %>
                      <%= '‚≠ê' %>
                    <% else %>
                      <%= 'No rating yet üòí' %>
                    <% end %>
                  </div>
                </div>
                <div class="loan-card-item-info-actions d-flex justify-content-center p-5">
                  <%= link_to 'üíå', user_path(loan.user), class: 'return-btn'%>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="card-odd">
            <% if loan.item.user == current_user %>
              <div class="card-lending" data-modal-target="loan" data-id= "<%= loan.id %>">
                <div class="loan-card-image"><%= cl_image_tag (loan.item.photo.key) %>
                </div>
                <p style="color: white; font-size: 40px;"><%= loan.item.item_name %></p>
                <div class="loan-card-item-info">
                  <p><%= "üë§ Lent to #{loan.user.first_name}" %></p>
                  <p><%="üéØ #{loan.return_date}" %></p>
                  <p><%= "üìù #{loan.item.description}" %></p>
                  <p>Rating:</p>
                  <div class='review'>
                    <% if loan.user.reviews.length >= 2 %>
                      <%= 'üåü' %>
                    <% elsif loan.user.reviews.length >= 0 %>
                      <%= '‚≠ê' %>
                    <% else %>
                      <%= 'No rating yet üòí' %>
                    <% end %>
                  </div>
                </div>
                <div class="loan-card-item-info-actions d-flex justify-content-between p-5">
                     <button class="review-btn" title="Give a review">‚≠êÔ∏è</button>
                    <div id="myModal" class="modal" data-controller="review">
                      <div class="modal-content">
                        <span class="close">&times;</span>
                        <%= render 'shared/new_review', loan: loan %>
                      </div>
                    </div>
                  <%= link_to 'üíå', user_path(loan.user), class: 'return-btn'%>
                  <% if loan.status == 'pending' %>
                    <div title="Accept loan" >
                        <button class='return-btn' data-modal-target='accept' data-action="click->modal#confirm" data-id= "<%= loan.id %>" data-user_id="<%= loan.user %>">
                        Ôºü</button>
                    </div>
                  <% else %>
                    <div title="Mark as returned" >
                      <button class='return-btn' data-action="click->modal#alert" data-id= "<%= loan.id %>" data-user_id="<%= loan.user %>">
                      ‚úÖ</button>
                    </div>
                  <% end %>
                </div>
              </div>
            <% else %>
              <div class="card-borrowing">
                <div class="loan-card-image"><%= cl_image_tag (loan.item.photo.key) %>
                </div>
                <p style="color: white; font-size: 40px;"><%= loan.item.item_name %></p>
                <div class="loan-card-item-info">
                  <p><%="üë§ Borrowed from #{loan.item.user.first_name}" %></p>
                  <p><%="üéØ #{loan.return_date}" %></p>
                  <p><%= "üìù #{loan.item.description}" %></p>
                  <p>Rating:</p>
                  <div class='review'>
                    <% if loan.user.reviews.length >= 2 %>
                      <%= 'üåü' %>
                    <% elsif loan.user.reviews.length >= 0 %>
                      <%= '‚≠ê' %>
                    <% else %>
                      <%= 'No rating yet üòí' %>
                    <% end %>
                  </div>
                </div>
                <div class="loan-card-item-info-actions d-flex justify-content-center p-5">
                  <%= link_to 'üíå', user_path(loan.user), class: 'return-btn'%>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
